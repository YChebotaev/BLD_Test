Как запускать?
==============

Потребуется redis, node.js, и npm

```bash
    node index.js
```

Кофигурационный файл
--------------------

Находится в папке `/config/default.json`

Если указана переменная окружения `NODE_ENV`, будет прочитан соответствующий файл в папке `/config/`.

Например, такая команда запустит приложение с файлом `/config/prod.json`

```bash
    NODE_ENV=prod node index.json
```

Ключи конфига:

HOST: задает хост, значение по-умолчанию: 0.0.0.0 (все адреса)

PORT: задает порт, значение по-умолчанию: 8080

MODULES: Содержит массив струкур конфигурации модулей.
Каждый модуль самостоятельно управляется со своей частью конфига.
Единственная общая часть у них у всех - это ключ `REQUIRE_PATH`, который задает файл с кодом модуля относительно корня приложения.

Модули:
------

###modules/default###

Пустой модуль, созданный для демонстрации интерфейса модуля.

###modules/sceduler###

Модуль - планировщик, обрабатвывает список сайтов, с которых нужно загружать информацию.

Пример конфигурации:

```json
{
    "REQUIRE_PATH": "./modules/scheduler",
    "SITES": [
        { // Структура конфигурации сайта
            // Страница, с которой осуществляется загрузка
            "startUri": "http://bitcoinwarrior.net/feed/",
            
            // Интервал, с которым происходит загрузка с этой страницы
            "updateInterval": 60000,
            
            // Количество попыток загрузки страницы в случае ошибки
            "attepmts": 1,
            
            // Количество миллисекунд, через которые будет повторена загрузка в случае ошибки
            "backoff": 3000,
            
            // Тип задания. Используется модулем modules/fetch
            "channel": "btcw"
        }
    ]
}

```

###modules/fetch###

Пример конфигурации

```json
{
   "REQUIRE_PATH": "./modules/fetch",
   "requestDefaults": {}
}
```

Фетчер. Основная и единственная функция фетчера - скачивать станицу.

После того, как страница окажется скачанной, фетчер создаст новое задание с типом `channel` из структуры конфигурации сайта.

Фетчер может быть сконфигурирован с ключом `requestDefaults`, который просто станет параметром метода `request#defaults`. См. модуль [request](https://www.npmjs.com/package/request).

###modules/bitcoinwarrior_net##

Пример конфигурации:

```json
{
    "REQUIRE_PATH": "./modules/bitcoinwarrior_net",
    "channel": "btcw",
    "filename": "./results/bitcoinwarrior_net.json"
}
```

Специфичный для сайта модуль.

Читает результаты работы модуля `fetch`, по типу задания, `channel`.

Парсит результат работы модуля `fetch`, и сохраняет файл, заданный ключом `filename`

Интерфейс модуля
----------------

```javascript
// default

module.exports = {
    
    config: {},
    
    queues: {},
    
    // Функция вызывается сразу после загрузки модуля,
    // со значеним, указанным в MODUES[]
    configure: function(config) {
        this.config = config;
    },
    
    // Функция вызывается для того, чтобы инициализировать
    // очереди, необходимые модулю для работы
    createQueue: function(queues, kue) {},
    
    // Функция вызывается, чтобы установить один или несколько
    // обработчиков маршрутов express-приложения
    setupApp: function(app) {},
    
    // Функция вызывается для того, чтобы запустить модуль
    start: function() {},
    
    // Функция вызывается, чтобы остановить модуль
    stop: function() {}
    
};
```